!function($){var CCI=CCI||{},Button=function(t){this.options=t,this.init(),this.refresh()};Button.prototype={init:function(){var t=this;t.container=$(t.templateContainer({id:t.options.id,is_subtle:t.options.btn_subtle,class:t.options.class||"btn-default"}))},refresh:function(){var t=this;t.container.html(t.templateContent({title:t.options.title,label:t.options.label,labelAlways:t.options.labelAlways,labelAll:t.options.labelAll,labelValue:t.options.labelValue}))},setValue:function(t,e){this.options.labelValue=t,this.options.title=e,this.refresh()},render:function(){return this.container},templateContainer:function(t){return'<button type="button" data-toggle="dropdown" aria-controls="'+t.id+'" class="btn btn-xs '+t.class+(t.is_subtle?" aui-button-subtle":"")+'" />'},templateContent:function(t){var e="",n="",i=t.labelValue&&""!==t.labelValue;return t.title&&""!==t.title&&(n=' title="'+t.title+'"'),e+='<div class="criteria-wrap"'+n+">",i&&!t.labelAlways||(e+='<span class="fieldLabel">'+t.label+":</span> "),e+=i?t.labelValue:t.labelAll,e+=' <span class="caret"></span>',e+="</div>"}};var Trigger=function(){};Trigger.prototype={_initTrigger:function(){this.triggers||(this.triggers={})},_setTrigger:function(t,e){this.triggers[t]||(this.triggers[t]=[]),this.triggers[t].push(e)},on:function(t,e){var n=this;n._initTrigger(),"object"==typeof t?$.each(t,function(t,e){n._setTrigger(t,e)}):n._setTrigger(t,e)},trigger:function(t){this._initTrigger();var e=this.triggers[t];if(e)for(var n in e)e.hasOwnProperty(n)&&e[n]()}};var Util={clone:function(t){var e;if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array){e=[];for(var n=0,i=t.length;n<i;n++)e[n]=Util.clone(t[n]);return e}if(t instanceof Object){for(var o in e={},t)t.hasOwnProperty(o)&&(e[o]=Util.clone(t[o]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")},arraysEqual:function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}},DropdownController=function(t){this.props={id:t.id,submitText:t.submitText},this.blocks=[],this._init()};DropdownController.prototype=Object.create(Trigger.prototype),DropdownController.prototype.constructor=DropdownController,DropdownController.prototype._init=function(){var e=this;e.component=$(e._templateContainer()),e.container=e.component.find("form"),e.initValue="",e.component.on("click",".submit-footer",function(t){e.trigger("submit")})},DropdownController.prototype._setInitValue=function(t){var e=Util.clone(t.getValue());e&&(e instanceof Array&&e!==[]||"string"==typeof e&&""!==e)&&(this.initValue=e,t.validValue(e)&&(this.value=e,this.valueLabel=t.getValueLabel(),this.valueTitle=t.getValueTitle(),this.trigger("change")))},DropdownController.prototype.addComponent=function(t){var e=this,n="_"+Math.round(Math.random()%10*Math.pow(10,10));this._setInitValue(t),this.blocks.push(n),(this.blocks[n]=t).on("change",function(){e._setComponentValue(n)}),this.container.append(t.render())},DropdownController.prototype._setComponentValue=function(t){var e=this.blocks[t],n=e.getValue()||"";if(""!==n)for(var i=0,o=this.blocks.length;i<o;i++){var a=this.blocks[i];a!==t&&this.blocks[a].setValue(null)}else e.setEmptyValue();console.log("_setComponentValue",n),this.value=n,this.valueLabel=e.getValueLabel(),this.valueTitle=e.getValueTitle(),this._showSubmit(!Util.arraysEqual(this.getInitValue(),n)),this.trigger("change")},DropdownController.prototype.resetToInitValue=function(){for(var t=0,e=this.blocks.length;t<e;t++){var n=this.blocks[t],i=this.blocks[n];i.validValue(this.initValue)&&(i.setValue(this.initValue),this._setComponentValue(n))}},DropdownController.prototype.getInitValue=function(){return this.initValue},DropdownController.prototype.getValue=function(){return this.value},DropdownController.prototype.getValueLabel=function(){return this.valueLabel},DropdownController.prototype.getValueTitle=function(){return this.valueTitle},DropdownController.prototype.render=function(){return this.component},DropdownController.prototype._showSubmit=function(t){this.component.find(".submit-footer").toggle(t)},DropdownController.prototype._templateContainer=function(){var t="";return t+='<div id="'+this.props.id+'" class="sa-filter-form  dropdown-menu">',t+='<form onsubmit="return false"></form>',t+=this._templateSubmit(),t+="</div>"},DropdownController.prototype._templateSubmit=function(){var t="";return this.props.submitText&&(t='<div class="submit-footer" style="display: none">'+this.props.submitText+"</div>"),t};var Block=function(){};Block.prototype=Object.create(Trigger.prototype),Block.prototype.constructor=Block,Block.prototype.validValue=function(t){return!1},Block.prototype.setValue=function(t){},Block.prototype.setEmptyValue=function(){},Block.prototype.getValue=function(){return null},Block.prototype.getValueLabel=function(){return null},Block.prototype.getValueTitle=function(){return null},Block.prototype.render=function(){return null};var DateRangeBlock=function(t){this.name=t.name,this.value=t.value||"",this.title={min:t.title.min,max:t.title.max},this.error_date=t.error_date,this._init()};DateRangeBlock.prototype=Object.create(Block.prototype),DateRangeBlock.prototype.constructor=DateRangeBlock,DateRangeBlock.prototype._init=function(){var t=this;t.component=$(t._template());var e=this.value;if(this.input=this.component.find('input[name="'+this.name+'"]'),-1<e.indexOf(",")){var n=e.substr(0,e.indexOf(",")),i=e.substr(e.indexOf(",")+1);this.component.find("#date-"+this.name+"-min").val(n),this.component.find("#date-"+this.name+"-max").val(i),this.input.val(this.value)}$(t.component).find(".date-picker").datepicker({format:"dd.mm.yyyy",weekStart:1,autoclose:!0,language:str_lang}),$(t.component).on("change",".date-picker",function(){t.handleChange(this)})},DateRangeBlock.prototype.handleChange=function(t){var e=$(t),n=e.attr("id")==="date-"+this.name+"-min"?"min":"max",i=this.value,o="",a="",s="",r="",l="",c="";console.log("oldFullValue",i),this.validValue(i)&&(a=o=i.substr(0,i.indexOf(",")),r=s=i.substr(i.indexOf(",")+1)),"min"===n?a=e.val():r=e.val(),a&&(l=a.substr(6,2)+a.substr(3,2)+a.substr(0,2)),r&&(c=r.substr(6,2)+r.substr(3,2)+r.substr(0,2)),a&&r&&c<l&&this.error_date?(setTimeout(function(){e.val("min"===n?o:s)},0),alert(this.error_date)):(this.setValue(a+(a||r?",":"")+r),this.trigger("change"))},DateRangeBlock.prototype.validValue=function(t){return-1<t.indexOf(",")||""===t},DateRangeBlock.prototype.setValue=function(t){this.value=t||"",null===t&&this.component.find(".date-picker").val(null),this.input.prop("disabled",null===t),this.validValue(this.value)&&this.input.val(this.value)},DateRangeBlock.prototype.setEmptyValue=function(){this.input.prop("disabled",!1),this.input.val("null")},DateRangeBlock.prototype.getValue=function(){return this.value},DateRangeBlock.prototype.getValueLabel=function(){var t=this.value;if(this.validValue(t)){var e=t.substr(0,t.indexOf(",")),n=t.substr(t.indexOf(",")+1);t=""==e&&""==n?null:""==e?"< "+n:""==n?"> "+e:e+" - "+n}return t},DateRangeBlock.prototype.getValueTitle=function(){return null},DateRangeBlock.prototype.render=function(){return this.component},DateRangeBlock.prototype.renderInput=function(){return this.input},DateRangeBlock.prototype._template=function(){var t="";return t+='<div class="form-body"><div class="field-group aui-field-workratio">',t+='<input name="'+this.name+'" type="hidden" disabled>',t+='<div class="'+this.name+'-min"><label for="date-'+this.name+'-min">'+(this.title.min?this.title.min:"Min")+"</label>",t+='<input class="text date-picker" id="date-'+this.name+'-min">',t+="</div>",t+='<div class="'+this.name+'-max"><label for="date-'+this.name+'-max">'+(this.title.max?this.title.max:"Max")+"</label>",t+='<input class="text date-picker" id="date-'+this.name+'-max">',t+="</div>",t+="</div></div>"};var NumRangeBlock=function(t){this.name=t.name,this.value=t.value||"",this.title={min:t.title.min,max:t.title.max},this.error_date=t.error_date,this._init()};NumRangeBlock.prototype=Object.create(Block.prototype),NumRangeBlock.prototype.constructor=NumRangeBlock,NumRangeBlock.prototype._init=function(){var t=this;t.component=$(t._template());var e=this.value;if(this.input=this.component.find('input[name="'+this.name+'"]'),-1<e.indexOf(",")){var n=e.substr(0,e.indexOf(",")),i=e.substr(e.indexOf(",")+1);this.component.find("#num-"+this.name+"-min").val(n),this.component.find("#num-"+this.name+"-max").val(i),this.input.val(this.value)}$(t.component).on("keyup","input.text",function(){t.handleChange(this)})},NumRangeBlock.prototype.handleChange=function(t){var e=$(t),n=e.attr("id")==="num-"+this.name+"-min"?"min":"max",i=this.value,o="",a="";console.log("oldFullValue",i),this.validValue(i)&&(o=i.substr(0,i.indexOf(",")),a=i.substr(i.indexOf(",")+1)),"min"===n?o=e.val():a=e.val(),this.setValue(o+(o||a?",":"")+a),this.trigger("change")},NumRangeBlock.prototype.validValue=function(t){return-1<t.indexOf(",")||""===t},NumRangeBlock.prototype.setValue=function(t){this.value=t||"",null===t&&this.component.find("input.text").val(null),this.input.prop("disabled",null===t),this.validValue(this.value)&&this.input.val(this.value)},NumRangeBlock.prototype.setEmptyValue=function(){this.input.prop("disabled",!1),this.input.val("null")},NumRangeBlock.prototype.getValue=function(){return this.value},NumRangeBlock.prototype.getValueLabel=function(){var t=this.value;if(this.validValue(t)){var e=t.substr(0,t.indexOf(",")),n=t.substr(t.indexOf(",")+1);t=""==e&&""==n?null:""==e?"< "+n:""==n?"> "+e:e+" - "+n}return t},NumRangeBlock.prototype.getValueTitle=function(){return null},NumRangeBlock.prototype.render=function(){return this.component},NumRangeBlock.prototype.renderInput=function(){return this.input},NumRangeBlock.prototype._template=function(){var t="";return t+='<div class="form-body"><div class="field-group aui-field-workratio">',t+='<input name="'+this.name+'" type="hidden" disabled>',t+='<div class="'+this.name+'-min"><label for="num-'+this.name+'-min">'+(this.title.min?this.title.min:"Min")+"</label>",t+='<input type="number" class="text" id="num-'+this.name+'-min">',t+="</div>",t+='<div class="'+this.name+'-max"><label for="num-'+this.name+'-max">'+(this.title.max?this.title.max:"Max")+"</label>",t+='<input type="number" class="text" id="num-'+this.name+'-max">',t+="</div>",t+="</div></div>"};var ListBlock=function(){};ListBlock.prototype=Object.create(Block.prototype),ListBlock.prototype.constructor=ListBlock,ListBlock.prototype.icon_search="icon-search4",ListBlock.prototype.icon_clear="icon-cancel-circle2",ListBlock.prototype._init=function(){var e=this;e.component=$(e._template()),e.container=e.component.find(".sa-filter-list-scroll"),e.elements=[],$.each(e.initOptions,function(){var t=$(this);e.elements.push({value:t.attr("value"),title:t.attr("title"),label:t.html(),active:t.prop("selected")})}),e.refresh(),$(e.container).on("click",".select-list-item, .check-list-item",function(t){t.preventDefault(),e.handleChange(this)}),$(e.component).on("click",".clear-all",function(t){t.preventDefault(),t.stopPropagation(),e.handleClear()}),$(e.component).on("click",".clear-field",function(){e.handleSearchClear(this)}),$(e.component).on("keyup","#"+e.props.search_id,function(){e.handleSearchChange(this)})},ListBlock.prototype.handleChange=function(t){},ListBlock.prototype.handleClear=function(){this.setEmptyValue(),this.trigger("change"),this.refresh()},ListBlock.prototype.handleSearchClear=function(t){$(t).prev().val(""),$(t).addClass(ListBlock.prototype.icon_search).removeClass("clear-field "+ListBlock.prototype.icon_clear),this.state.hide=this.props.hide||"0",this.refresh()},ListBlock.prototype.handleSearchChange=function(t){var n=this,e=$(t),i=e.val().toLowerCase();if(i.length<0)e.next().addClass(ListBlock.prototype.icon_search).removeClass("clear-field "+ListBlock.prototype.icon_clear),n.state.hide=this.props.hide||"0",n.refresh();else{e.next().removeClass(ListBlock.prototype.icon_search).addClass("clear-field "+ListBlock.prototype.icon_clear);var o,a=[];if(n.props.searchUrl){var s={q:i};n.props.searchUrlCache&&"1"==n.props.searchUrlCache&&(s.cache=Math.random()),$.ajax({url:n.props.searchUrl,dataType:"json",data:s,async:!1,success:function(t){$.each(t.items,function(t,e){o=1===n.elements.filter(function(t){return t.value===e.id&&t.active}).length,a.push({value:e.value,label:e.label,active:o})}),n.state.hide=t.hide||"0"}})}else $.each(n.elements,function(t,e){(-1<e.label.toLowerCase().indexOf(i)||-1<e.value.toLowerCase().indexOf(i))&&a.push(e)}),n.state.hide=0;n.container.empty(),0===a.length?(n.container.find(".more-criteria-footer").remove(),n.container.html('<li class="no-suggestions">'+n.props.nomatchText+"</li>")):n.refresh(a)}},ListBlock.prototype.getValue=function(){return this.value},ListBlock.prototype.getValueLabel=function(){return $(this.elements).map(function(){if(this.active)return this.label?this.label:this.value}).get().join(", ")},ListBlock.prototype.getValueTitle=function(){return $(this.elements).map(function(){if(this.active)return this.title?this.title:this.label}).get().join("\n")},ListBlock.prototype.refresh=function(t){},ListBlock.prototype.render=function(){return this.component},ListBlock.prototype._template=function(){var t="";return t+=this.has_search?this._templateSearch():"",t+='<div class="sa-filter-list" tabindex="-1"><div id="'+this.props.search_container+'" class="sa-filter-list-scroll" tabindex="-1"></div></div>'},ListBlock.prototype._templateList=function(t){return'<ul class="aui-list-section'+(t?" selected-group":"")+'"></ul>'},ListBlock.prototype._templateListClear=function(){if(this.clearTitle)return'<li class="sa-filter-group-actions"><a href="#" class="clear-all">'+this.clearTitle+"</a></li>"},ListBlock.prototype._templateSearch=function(){return'<div class="sa-filter-search"><input autocomplete="off" aria-autocomplete="list" placeholder="'+this.props.searchTitle+'" class="form-control" id="'+this.props.search_id+'" aria-controls="'+this.props.search_container+'"><span class="icon-default '+ListBlock.prototype.icon_search+' noloading"></span></div>'};var SingleSelectBlock=function(t){this.name=t.name,this.value=t.value||"",this.has_search=t.has_search,this.props={searchTitle:t.searchTitle,search_id:t.search_id||"search",search_container:t.search_container,searchUrl:t.searchUrl,searchUrlCache:t.searchUrlCache,nomatchText:t.nomatchText,exclude:t.exclude,hidden:t.hidden,hide:t.hide,clear:null==t.clear||t.clear},this.state={hide:t.hide},this.clearTitle=t.clearTitle,this.initOptions=t.options,this._init()};SingleSelectBlock.prototype=Object.create(ListBlock.prototype),SingleSelectBlock.prototype.constructor=SingleSelectBlock,SingleSelectBlock.prototype.handleChange=function(t){var e=$(t),n=e.attr("data-value"),i=!0;$.each(this.elements,function(t,e){e.value===n&&(i=!1)}),i&&(this.elements.push({value:n,title:e.attr("title"),label:e.find("label").html(),active:!0}),this.initOptions.parent().append('<option value="'+n+'" title="'+e.attr("title")+'">'+e.find("label").html()+"</option>")),this.setValue(n),this.trigger("change")},SingleSelectBlock.prototype.validValue=function(t){return 0<this.container.find(".select-list-item").filter('[data-value="'+t+'"]').length||""===t},SingleSelectBlock.prototype.setValue=function(t){var n=this;if(this.resetOption&&this.resetOption.remove(),this.value=t||"",this.container.find(".select-list-item").filter(".active").removeClass("active"),$.each(this.elements,function(t,e){e.active=e.value===n.value}),null!==t){var e=this.container.find(".select-list-item").filter('[data-value="'+t+'"]');e.length&&e.addClass("active")}else this.refresh();this.validValue(this.value)&&this.initOptions.parent().val(this.value)},SingleSelectBlock.prototype.setEmptyValue=function(){this.setValue(null),this.resetOption||(this.resetOption=this.initOptions.parent().after($('<input type="hidden" name="'+this.name+'" value="null">')))},SingleSelectBlock.prototype.refresh=function(t){var n=this,i=$(this._templateList());if(t)$.each(t,function(t,e){i.append(n._templateListItem(e))});else{var o=!1;$.each(this.elements,function(t,e){e.active&&(o=!0),i.append(n._templateListItem(e))}),o&&n.props.clear&&i.prepend(this._templateListClear())}n.container.empty(),n.container.append(i),this.container.find(".more-criteria-footer").remove(),this.state.hide&&"0"!==this.state.hide&&this.container.append('<div class="more-criteria-footer">...'+this.props.exclude+' <span class="hidden-no">'+this.state.hide+"</span> "+this.props.hidden+"</div>")},SingleSelectBlock.prototype._templateListItem=function(t){return'<li class="select-list-item'+(t.active?" active":"")+'" title="'+(t.title?t.title:"")+'" data-value="'+t.value+'"><label class="item-label">'+t.label+"</label></li>"};var MultiSelectBlock=function(t){this.name=t.name,this.value=t.value||[],this.has_search=t.has_search,this.props={searchTitle:t.searchTitle,search_id:t.search_id||"search",search_container:t.search_container,searchUrl:t.searchUrl,searchUrlCache:t.searchUrlCache,nomatchText:t.nomatchText,exclude:t.exclude,hidden:t.hidden,hide:t.hide,clear:null==t.clear||t.clear},this.state={hide:t.hide},this.clearTitle=t.clearTitle,this.select=t.select,this.initOptions=t.options,this._init()};MultiSelectBlock.prototype=Object.create(ListBlock.prototype),MultiSelectBlock.prototype.constructor=MultiSelectBlock,MultiSelectBlock.prototype.handleChange=function(t){var e=$(t),n=e.find("input").val(),i=!0,o=!e.find("input").is(":checked");if($.each(this.elements,function(t,e){e.value===n&&(i=!1)}),i){var a=e.attr("title")||"",s=e.find("label").text();this.elements.push({value:n,title:a,label:s,active:!0}),console.log(this.select),this.select.append('<option value="'+n+'" title="'+a+'" selected>'+s+"</option>")}var r=this.getValue();1===r.length&&-1<r.indexOf(n)&&!o?this.setEmptyValue():this.setValue(n,o),this.trigger("change")},MultiSelectBlock.prototype.validValue=function(t){return t instanceof Array||0<this.container.find(".check-list-item").find('input[value="'+t+'"]').length||""===t||t===[]},MultiSelectBlock.prototype.setValue=function(n,i){var t,e=this.value.indexOf(n);this.resetOption&&this.resetOption.remove(),n&&e<0&&i?this.value.push(n):n&&-1<e&&!i?this.value.splice(e,1):null===n&&(this.value=[]),$.each(this.elements,function(t,e){null===n?e.active=!1:e.value===n&&(e.active=i)}),null!==n?(t=this.container.find(".check-list-item").find('input[value="'+n+'"]')).length&&t.prop("checked",i):(t=this.container.find(".check-list-item").find("input:checked")).length&&t.prop("checked",!1),console.log("MultiSelectBlock.setValue",n,i),this.validValue(n)&&this.initOptions.filter('[value="'+n+'"]').attr("selected",i)},MultiSelectBlock.prototype.setEmptyValue=function(){console.log("MultiSelectBlock.setEmptyValue"),this.setValue(null),this.initOptions.filter("[selected]").attr("selected",!1),this.resetOption||(this.resetOption=this.select.after($('<input type="hidden" name="'+this.name+'" value="null">')))},MultiSelectBlock.prototype.refresh=function(t){var e,n=this,i=$(this._templateList()),o=$(this._templateList(!0));if(t)$.each(t,function(t,e){e.active?o.append(n._templateListItem(e)):i.append(n._templateListItem(e))});else{var a=!1;$.each(this.elements,function(t,e){e.active?(a=!0,o.append(n._templateListItem(e))):i.append(n._templateListItem(e))}),a&&n.props.clear&&(e=$(this._templateListClear()))}n.container.empty(),e&&n.container.append(e),0<o.length&&n.container.append(o),n.container.append(i),this.container.find(".more-criteria-footer").remove(),this.state.hide&&"0"!==this.state.hide&&this.container.append('<div class="more-criteria-footer">...'+this.props.exclude+' <span class="hidden-no">'+this.state.hide+"</span> "+this.props.hidden+"</div>")},MultiSelectBlock.prototype._templateListItem=function(t){return'<li class="check-list-item"><label class="item-label" title="'+t.title+'"><input type="checkbox" tabindex="-1" value="'+t.value+'" '+(t.active?"checked":"")+">"+t.label+"</label></li>"},CCI.QueryableDropdownSelect=function(t){this._setOptions(t),this.container_id="_"+Math.round(Math.random()%10*Math.pow(10,10)),this._createButton(),this._createDropdownController(),this._assignEvents(),this.render()},CCI.QueryableDropdownSelect.prototype={_setOptions:function(t){var e=this;e.container=$(t),e.elements=e.container.find("select").find("option"),this.props={name:e.container.find("select").attr("name"),value:e.container.find("select").val(),hide:e.container.find("select").attr("data-hide")||"0",clear_text:e.container.attr("data-clear"),search_str:e.container.attr("data-search"),title:e.container.attr("data-title"),title_always:e.container.attr("data-title-always"),btn_class:e.container.attr("data-btn-class"),nomatch:e.container.attr("data-nomatch"),ALL:e.container.attr("data-ALL"),url:e.container.attr("data-url"),urlCache:e.container.attr("data-urlCache"),exclude:e.container.attr("data-exclude"),hidden:e.container.attr("data-hidden"),btn_subtle:e.container.hasClass("subtle"),submit:e.container.attr("data-submit"),submit_text:e.container.attr("data-submit-text")}},_createButton:function(){var t=this;this.button=new Button({id:t.container_id+"-dropdown",is_subtle:t.props.btn_subtle,class:t.props.btn_class,label:t.props.title,labelAlways:t.props.title_always,labelAll:t.props.ALL})},_createDropdownController:function(){var instance=this;this.dropdown=new DropdownController({id:this.container_id+"-dropdown",submitText:this.props.submit_text}),this.dropdown.on({change:function(){instance.button.setValue(instance.dropdown.getValueLabel(),instance.dropdown.getValueTitle())},submit:function(){eval(instance.props.submit),$(instance.container).dropdown("toggle")}}),this.blockSingleSelect=new SingleSelectBlock({name:this.props.name,value:this.props.value,has_search:!!this.props.search_str,clearTitle:this.props.clear_text,options:this.elements,searchTitle:!!this.props.search_str&&this.props.search_str+"...",search_id:this.container_id+"-search",search_container:this.container_id+"-suggestion",searchUrl:this.props.url,searchUrlCache:this.props.urlCache,nomatchText:this.props.nomatch,hide:this.props.hide,exclude:this.props.exclude,hidden:this.props.hidden}),this.dropdown.addComponent(this.blockSingleSelect)},_assignEvents:function(){var t=this;$(t.container).on("shown.bs.dropdown",function(){t.blockSingleSelect.refresh()}),$(t.container).on("hidden.bs.dropdown",function(){t.props.submit&&t.dropdown.getInitValue()!==t.dropdown.getValue()&&t.dropdown.resetToInitValue()})},render:function(){this.container.append(this.button.render()),this.container.append(this.dropdown.render())}},$(".sa-filter-select").each(function(){new CCI.QueryableDropdownSelect(this)}),CCI.QueryableDropdownMultiSelect=function(t){this._setOptions(t),this.container_id="_"+Math.round(Math.random()%10*Math.pow(10,10)),this._createButton(),this._createDropdownController(),this._assignEvents(),this.render()},CCI.QueryableDropdownMultiSelect.prototype={_setOptions:function(t){var e=this;e.container=$(t),e.select=e.container.find("select"),e.elements=e.container.find("select").find("option"),this.props={name:e.container.find("select").attr("name"),value:e.container.find("select").val(),hide:e.container.find("select").attr("data-hide")||"0",clear_text:e.container.attr("data-clear"),search_str:e.container.attr("data-search"),title:e.container.attr("data-title"),title_always:e.container.attr("data-title-always"),btn_class:e.container.attr("data-btn-class"),nomatch:e.container.attr("data-nomatch"),ALL:e.container.attr("data-ALL"),url:e.container.attr("data-url"),urlCache:e.container.attr("data-urlCache"),exclude:e.container.attr("data-exclude"),hidden:e.container.attr("data-hidden"),btn_subtle:e.container.hasClass("subtle"),submit:e.container.attr("data-submit"),submit_text:e.container.attr("data-submit-text")}},_createButton:function(){var t=this;this.button=new Button({id:t.container_id+"-dropdown",is_subtle:t.props.btn_subtle,class:t.props.btn_class,label:t.props.title,labelAlways:t.props.title_always,labelAll:t.props.ALL})},_createDropdownController:function(){var instance=this;this.dropdown=new DropdownController({id:this.container_id+"-dropdown",submitText:this.props.submit_text}),this.dropdown.on({change:function(){instance.button.setValue(instance.dropdown.getValueLabel(),instance.dropdown.getValueTitle())},submit:function(){eval(instance.props.submit),$(instance.container).dropdown("toggle")}}),this.blockMultiSelect=new MultiSelectBlock({name:this.props.name,value:this.props.value,has_search:!0,clearTitle:this.props.clear_text,select:this.select,options:this.elements,searchTitle:this.props.search_str+"...",search_id:this.container_id+"-search",search_container:this.container_id+"-suggestion",searchUrl:this.props.url,searchUrlCache:this.props.urlCache,nomatchText:this.props.nomatch,hide:this.props.hide,exclude:this.props.exclude,hidden:this.props.hidden}),this.dropdown.addComponent(this.blockMultiSelect)},_assignEvents:function(){var t=this;$(t.container).on("shown.bs.dropdown",function(){t.blockMultiSelect.refresh()}),$(t.container).on("hidden.bs.dropdown",function(){console.log("hidden.bs.dropdown"),t.props.submit&&t.dropdown.getInitValue()!==t.dropdown.getValue()&&t.dropdown.resetToInitValue()})},render:function(){this.container.append(this.button.render()),this.container.append(this.dropdown.render())}},$(".sa-filter-multiselect").each(function(){new CCI.QueryableDropdownMultiSelect(this)}),CCI.QueryableDropdownNumRange=function(t){this._setOptions(t),this.container_id="_"+Math.round(Math.random()%10*Math.pow(10,10)),this.createButton(),this.createDropdownController(),this.createBlocks(),this.render(),this.assignEvents()},CCI.QueryableDropdownNumRange.prototype={_setOptions:function(t){var e=this;e.component=$(t),this.props={clear_text:e.component.attr("data-clear"),title:e.component.attr("data-title"),title_always:e.component.attr("data-title-always"),ALL:e.component.attr("data-ALL"),min:e.component.attr("data-min"),max:e.component.attr("data-max"),type:e.component.attr("data-type")||"",name:e.component.attr("data-name"),value:e.component.attr("data-value"),title_min:e.component.attr("data-title-min"),title_max:e.component.attr("data-title-max"),btn_subtle:e.component.hasClass("subtle"),submit:e.component.attr("data-submit"),submit_text:e.component.attr("data-submit-text")}},createButton:function(){var t=this;this.button=new Button({id:t.container_id+"-dropdown",is_subtle:t.props.btn_subtle,class:t.props.btn_class,label:t.props.title,labelAlways:t.props.title_always,labelAll:t.props.ALL})},createDropdownController:function(){var instance=this;this.dropdown=new DropdownController({id:this.container_id+"-dropdown",submitText:this.props.submit_text}),this.dropdown.on({change:function(){instance.button.setValue(instance.dropdown.getValueLabel(),instance.dropdown.getValueTitle())},submit:function(){instance.props.onSubmit=!0,$(instance.component).dropdown("toggle"),eval(instance.props.submit)}})},createBlocks:function(){this.blockNumRange=new NumRangeBlock({name:this.props.name,value:this.props.value,title:{min:this.props.title_min,max:this.props.title_max},error_date:"Значення початку не може бути більше закінчення"}),this.dropdown.addComponent(this.blockNumRange)},assignEvents:function(){var t=this;t.component.on("hidden.bs.dropdown",function(){t.props.submit&&!t.props.onSubmit&&t.dropdown.getInitValue()!==t.dropdown.getValue()&&t.dropdown.resetToInitValue(),t.props.onSubmit&&(t.props.onSubmit=!1)})},render:function(){this.component.append(this.button.render()),this.component.append(this.dropdown.render()),this.component.append(this.blockNumRange.renderInput())}},$(".sa-filter-num").each(function(){new CCI.QueryableDropdownNumRange(this)}),CCI.QueryableDropdownDateRange=function(t){this._setOptions(t),this.container_id="_"+Math.round(Math.random()%10*Math.pow(10,10)),this._createButton(),this._createDropdownController(),this._createBlocks(),this._render(),this._assignEvent()},CCI.QueryableDropdownDateRange.prototype={_setOptions:function(t){var e=this;e.component=$(t),e.elements=e.component.find("select").find("option"),e.props={clear_text:e.component.attr("data-clear"),title:e.component.attr("data-title"),ALL:e.component.attr("data-ALL"),name:e.component.attr("data-name"),value:e.component.attr("data-value"),btn_class:e.component.attr("data-btn-class"),title_min:e.component.attr("data-min"),title_max:e.component.attr("data-max"),btn_subtle:e.component.hasClass("subtle"),submit:e.component.attr("data-submit"),submit_text:e.component.attr("data-submit-text")}},_createButton:function(){var t=this;this.button=new Button({id:t.container_id+"-dropdown",is_subtle:t.props.btn_subtle,class:t.props.btn_class,label:t.props.title,labelAlways:!1,labelAll:t.props.ALL})},_createDropdownController:function(){var instance=this;this.dropdown=new DropdownController({id:this.container_id+"-dropdown",submitText:this.props.submit_text}),this.dropdown.on({change:function(){instance.button.setValue(instance.dropdown.getValueLabel(),instance.dropdown.getValueTitle())},submit:function(){instance.props.onSubmit=!0,eval(instance.props.submit),$(instance.container).dropdown("toggle")}})},_createBlocks:function(){this.blockDateRange=new DateRangeBlock({name:this.props.name,value:this.props.value,title:{min:this.props.title_min,max:this.props.title_max},error_date:"Дата початку не може бути більше закінчення"}),this.dropdown.addComponent(this.blockDateRange),this.blockSingleSelect=new SingleSelectBlock({name:this.props.name,value:this.props.value,has_search:!1,clearTitle:this.props.clear_text,options:this.elements}),this.dropdown.addComponent(this.blockSingleSelect)},_assignEvent:function(){var t=this;t.component.on("shown.bs.dropdown",function(){t.blockSingleSelect.refresh()}),t.component.on("hidden.bs.dropdown",function(){t.props.submit&&!t.props.onSubmit&&t.dropdown.getInitValue()!==t.dropdown.getValue()&&t.dropdown.resetToInitValue(),t.props.onSubmit&&(t.props.onSubmit=!1)})},_render:function(){this.component.append(this.button.render()),this.component.append(this.dropdown.render()),this.component.append(this.blockDateRange.renderInput())}},$(".sa-filter-date").each(function(){new CCI.QueryableDropdownDateRange(this)})}(jQuery);