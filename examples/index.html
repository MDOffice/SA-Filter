<html>
<head>
    <title>SA-Filter-Bootstrap 3 Examples</title>

    <link rel="stylesheet" href="bootstrap3.css" media="all">
    <link rel="stylesheet" href="bootstrap-datepicker3.css" media="all">
    <link href="main.css" rel="stylesheet">
    <style>
        form {
            margin: 0
        }
    </style>

</head>
<body>
<h1>SA-Filter-Bootstrap 3 Examples</h1>

<header class="filters clearfix">
    <form id="cert-filter" action="#" class="form-inline">
        <div class="sa-filter dropdown sa-filter-date"
             data-clear="Очистити"
             data-title="Дата"
             data-ALL="Будь-яка"
             data-name="p_date"
             data-btn-class=""
             data-value="01.08.2019,02.08.2019"
             data-min="Початок періоду"
             data-max="Кінець періоду"
             data-submit="alert('submit')"
             data-submit-text="Застосувати">
            <select name="p_date" class="multi-select" multiple title="Date">
                <option value="today">за сьогодні</option>
                <option value="week">за тиждень</option>
                <option value="month">за місяць</option>
            </select>
        </div>
        <div class="sa-filter dropdown sa-filter-date"
             data-clear="Очистити"
             data-title="Дата"
             data-ALL="Будь-яка"
             data-name="p_date"
             data-btn-class=""
             data-value=""
             data-submit="alert('submit')"
             data-submit-text="Застосувати"
             data-min="Початок періоду"
             data-max="Кінець періоду">
        </div>
        <div class="sa-filter dropdown sa-filter-date"
             data-clear="Очистити"
             data-title="Дата"
             data-ALL="Будь-яка"
             data-name="p_date"
             data-btn-class=""
             data-value="01.08.2019,02.08.2019"
             data-submit="alert('submit')"
             data-submit-text="Застосувати"
             data-min="Початок періоду"
             data-max="Кінець періоду">
        </div>
        <div class="sa-filter dropdown sa-filter-multiselect"
             data-clear="Очистити"
             data-search="Назва"
             data-title="Статус"
             data-btn-class=""
             data-nomatch="Немає збігів"
             data-ALL="Будь-які">
            <select name="p_status_1" class="multi-select" multiple aria-label="3">
                <option value="nowork">Не дійсний</option>
                <option value="work">Дійсний</option>
                <option value="anul">Анульований</option>
            </select>
        </div>
        <div class="sa-filter dropdown sa-filter-multiselect"
             data-clear="Очистити"
             data-clear-always="1"
             data-selected-ignore="1"
             data-title="Статус"
             data-btn-class=""
             data-nomatch="Немає збігів"
             data-ALL="Будь-які">
            <select name="p_status_2" class="multi-select" multiple aria-label="4">
                <option value="nowork">Не дійсний</option>
                <option disabled></option>
                <option value="work" disabled>Дійсний</option>
                <option disabled>123</option>
                <option value="anul">Анульований</option>
            </select>
        </div>
        <div class="sa-filter dropdown sa-filter-multiselect"
             data-clear="Очистити"
             data-search="Назва"
             data-title="Статус"
             data-btn-class=""
             data-nomatch="Немає збігів"
             data-ALL="Будь-які"
             data-submit="alert('submit')"
             data-submit-text="Застосувати">
            <select name="p_status_3" class="multi-select" multiple title="Status">
                <option value="nowork" selected>Не дійсний</option>
                <option value="work">Дійсний</option>
                <option value="anul">Анульований</option>
            </select>
        </div>
        <div class="sa-filter dropdown sa-filter-select"
             data-clear="Очистити"
             data-search="Назва"
             data-title="Статус"
             data-btn-class=""
             data-nomatch="Немає збігів"
             data-ALL="Будь-які"
             data-submit="alert('submit')"
             data-submit-text="Застосувати">
            <select name="p_status_4" class="select" title="Status">
                <option value="nowork" selected>Не дійсний</option>
                <option value="work">Дійсний</option>
                <option value="anul">Анульований</option>
            </select>
        </div>

        <div class="mb-5 dropdown sa-filter sa-filter-multiselect"
             data-clear="Очистити елементи"
             data-search="Назва"
             data-title="Вид діяльності"
             data-nomatch="Немає збігів"
             data-ALL="Будь-який"
             data-submit="alert('submit')"
             data-submit-text="Застосувати"
        ><select name="p_activity" multiple>
            <option value="AT" selected>AT - Карнети АТА</option>
            <option value="CO" selected>CO - Сертифікація походження товарів</option>
            <option value="EO">EO - Експертиза інша</option>
            <option value="EX">EX - Експертиза товарознавча</option>
            <option value="EZ">EZ - Землеоціночні роботи</option>
            <option value="FM">FM - Форс-Мажори</option>
            <option value="IS">IS - Інформаційні послуги</option>
            <option value="LS">LS - Юридичні послуги</option>
            <option value="ME">ME - Робота з членами палати</option>
            <option value="OM">OM - Оцінка об'ектів матеріальної та не матеріальної форми</option>
            <option value="ЕS">ЕS - Експертиза судова</option>
        </select></div>
    </form>

    <form id="map-filter" class="ignoreNeedSave navbar-nav ml-1 d-block mb-n1" style="margin-top:100px">
        <div class="dropdown sa-filter sa-filter-multiselect mr-1 mb-1"
             data-clear="Очистити"
             data-title="Суміжна країна"
             data-nomatch="Немає збігів"
             data-ALL="Будь-яка"
             data-clear-always="1"
             data-selected-ignore="1"
             data-btn-class="btn-default"
        ><select name="p_country" multiple>
            <option value="1" data-min-lat="49.3841551" data-max-lat="52.3654559" data-min-lng="31.7765104"
                    data-max-lng="40.1198722">Російська Федерація
            </option>
            <option value="2" data-min-lat="48.8067667" data-max-lat="52.0721152" data-min-lng="22.4925509"
                    data-max-lng="31.9445059">Республіка Білорусь
            </option>
            <option value="3" data-min-lat="49.4776949" data-max-lat="51.198201" data-min-lng="22.7182584"
                    data-max-lng="24.1435693">Республіка Польща
            </option>
            <option value="4" data-min-lat="48.431698" data-max-lat="48.8618526" data-min-lng="22.1607738"
                    data-max-lng="22.9062578">Словацька Республіка
            </option>
            <option value="5" data-min-lat="48.0981729" data-max-lat="48.4319471" data-min-lng="22.1621546"
                    data-max-lng="22.8370541">Угорщина
            </option>
            <option value="6" data-min-lat="45.3204643" data-max-lat="48.0238166" data-min-lng="22.9977252"
                    data-max-lng="28.4454511">Румунія
            </option>
            <option value="7" data-min-lat="45.4374788" data-max-lat="48.4584391" data-min-lng="26.569941"
                    data-max-lng="30.1063663">Республіка Молдова
            </option>
        </select></div>
        <div class="dropdown sa-filter sa-filter-multiselect mr-1 mb-1"
             data-clear="Очистити"
             data-title="Установа"
             data-nomatch="Немає збігів"
             data-ALL="Будь-яка"
             data-clear-always="1"
             data-selected-ignore="1"
             data-btn-class="btn-default"
        ><select name="p_location" multiple>
            <option value="25">Митниця</option>
            <option value="30">Митний пост</option>
            <option value="31">Митний пост - керівництво</option>
            <option disabled></option>
            <option value="40">Пункт пропуску</option>
            <option value="15">Пункт пропуску - Алкоголь, Тютюн</option>
            <option value="99">Пункт пропуску - Алмази</option>
            <option value="50">Пункт пропуску - Наркотики, Прекурсори</option>
            <option disabled></option>
            <option value="65">Місце оформлення EUR.1</option>
            <option value="61">Місця міжнародного поштового обміну</option>
            <option value="66">Сортувальні станції експрес-перевізників</option>
            <option disabled>Склад</option>
            <option value="3">Митний склад - відкритий</option>
            <option value="4">Митний склад - закритий</option>
            <option value="2">Склад тимчасового зберігання</option>
            <option disabled></option>
            <option value="1">Магазин безмитної торгівлі</option>
            <option value="5">Митні брокери</option>
        </select></div>
        <div class="dropdown sa-filter sa-filter-multiselect mr-1 mb-1"
             data-clear="Очистити"
             data-title="Вид сполучення"
             data-nomatch="Немає збігів"
             data-ALL="Будь-який"
             data-clear-always="1"
             data-selected-ignore="1"
             data-btn-class="btn-default"
        ><select name="p_connect" multiple>
            <option value="1">Автомобільний</option>
            <option value="2">Залізничний</option>
            <option value="3">Повітряний</option>
            <option value="4">Річковий</option>
            <option value="5">Морський</option>
            <option value="6">Поромний</option>
            <option value="7">Пішохідний</option>
            <option value="8">Трубопровідний</option>
        </select></div>
        <div class="dropdown sa-filter sa-filter-multiselect mr-1 mb-1"
             data-clear="Очистити"
             data-title="Функціонування"
             data-nomatch="Немає збігів"
             data-ALL="Будь-який"
             data-clear-always="1"
             data-selected-ignore="1"
             data-btn-class="btn-default"
        ><select name="p_work" multiple>
            <option value="1">Функціонуючий</option>
            <option value="2">Тимчасово призупинений</option>
            <option disabled></option>
            <option value="3">Цілодобово</option>
            <option value="4">По розкладу</option>
        </select></div>
    </form>
</header>

<!-- Dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.8.6/umd/react.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.8.6/umd/react-dom.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/EventEmitter/5.2.6/EventEmitter.js"></script>

<!-- Main -->

<script src="jquery-3.3.1.js"></script>
<script src="bootstrap3.js"></script>
<script src="bootstrap-datepicker.js"></script>

<script src="main.umd.js"></script>
<script>
    SAFilter.setDefaults({
        initDatepicker: function (datePickerElement, onChangeCallback) {
            $(datePickerElement)
                .datepicker({
                    format: 'dd.mm.yyyy',
                    weekStart: 1,
                    autoclose: true,
                    language: 'ua',
                    clearBtn: true
                })
                .on('changeDate', function () {
                    console.log('datepicker.changeDate');
                    onChangeCallback(this);
                });
        }
    });

    $('[name=p_status_2]')
        .on('change', function () {
            const checkbox = $('[name=p_status_1]')
                .closest('.sa-filter')
                .find(`[type="checkbox"][value="${this.value}"]`);

            console.log('p_status_1:click:before');
            checkbox.trigger('click');
            console.log('p_status_1:click:after');
        });

    $('[name=p_status_1]')
        .on('change', function () {
            console.log('p_status_1:onChange');
        });


    //#map-filter

    filterState = {
        country: [],
        location: [],
        connect: [],
        work: []
    };

    const depends = (input) => {
        const LOCATION_PP = '40';

        const btn = input.closest('.sa-filter').find('button');
        const name = input.attr('name');
        const value = input.val();
        if (value.length === 0) {
            btn.removeClass('bg-slate').addClass('btn-light');
            if (name === 'p_connect') {
                $('[name=p_location]').closest('.sa-filter').find('button').prop('disabled', false);
            } else if (name === 'p_location') {
                $('[name=p_connect]').closest('.sa-filter').find('button').prop('disabled', false);
                $('[name=p_connect]').closest('.sa-filter').find('[type="checkbox"]:checked').trigger('click');
                $('[name=p_country]').closest('.sa-filter').find('button').prop('disabled', false);
                $('[name=p_work]').closest('.sa-filter').find('button').prop('disabled', false);
            }
        } else {
            btn.addClass('bg-slate').removeClass('btn-light');
            if (name === 'p_country') {
                const locationPP = $('[name=p_location]').closest('.sa-filter').find('[type="checkbox"][value="40"]');
                if (!locationPP.is(':checked')) {
                    locationPP.trigger('click');
                }
            } else if (name === 'p_connect') {
                const locationPP = $('[name=p_location]').closest('.sa-filter').find('[type="checkbox"][value="40"]');
                if (!locationPP.is(':checked')) {
                    locationPP.trigger('click');
                }
            } else if (name === 'p_location') {
                const existsPP = value.indexOf(LOCATION_PP) > -1;
                const existsNormalLoad = value.filter((item) => {
                    return true;
                }).length > 0;
                $('[name=p_connect]').closest('.sa-filter').find('button').prop('disabled', !existsPP || !existsNormalLoad);
                $('[name=p_country]').closest('.sa-filter').find('button').prop('disabled', !existsNormalLoad);
                $('[name=p_work]').closest('.sa-filter').find('button').prop('disabled', !existsNormalLoad);
            }
        }

        if (name === 'p_work') {
            setTimeout(function() {
                let items = input.closest('.sa-filter').find('.check-list-item');
                if (value.length === 0) {
                    items.filter('.disabled')
                        .removeClass('disabled')
                        .find('input[type="checkbox"]').prop('disabled', false);
                } else {
                    if (value.indexOf('2') > -1) {
                        items = items.filter((index, item) => {
                            console.log(item, $(item).find('input[type="checkbox"][value]').val());
                            return $(item).find('input[type="checkbox"][value]').val() !== '2';
                        });
                        console.log(items);
                        items.addClass('disabled').find('input[type="checkbox"]').prop('disabled', true);
                    } else {
                        items = items.filter((index, item) => {
                            return $(item).find('input[type="checkbox"][value]').val() === '2';
                        });
                        items.addClass('disabled').find('input[type="checkbox"]').prop('disabled', true);
                    }
                }
            }, 100);
        }
    }

    const onChange = (inputName, filter) => {
        const input = $(`[name="${inputName}"]`);
        input.on('change', () => {
            filter(input.val());

            depends(input);
        });
    };

    onChange('p_country', (filter) => filterState.country = filter);
    onChange('p_location', (filter) => filterState.location = filter);
    onChange('p_connect', (filter) => filterState.connect = filter);
    onChange('p_work', (filter) => filterState.work = filter);

</script>


</body>
</html>
